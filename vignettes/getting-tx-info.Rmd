---
title: "Transactions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Querying the information on transactions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Individual transactions

The are several functions in the `tronr` package that allow one to obtain information on the TRON blockchain transactions. One of the key functions is `get_tx_info_by_id()`, which returns a transaction's attributes based on its ID (in the form of a [nested tibble](https://tidyr.tidyverse.org/articles/nest.html "Nested data in R")). Such IDs can be obtained using several other `tronr` functions, e.g. `get_block_info()`, `get_blocks_for_time_range()`, `get_tx_for_time_range()` (see below), etc. Here is an example:

```{r get-tx-by-id, message=FALSE}
require(tronr)
require(dplyr)
require(tidyr)

# Get transactions of the latest block:
latest_block <- get_block_info(latest = TRUE)

# Pick an example transaction:
tx_id <- latest_block$tx[[1]]$tx_id[1]
tx_id

# Retrieve transaction attributes (see ?get_tx_info_by_id
# for their definitions):
r1 <- get_tx_info_by_id(tx_id = tx_id, add_contract_data = FALSE)
glimpse(r1)
```

If the `add_contact_data` argument is set to `TRUE`, the resultant tibble will also have a column named `contract_data`. This column will contain a list with raw data generated by the contract that performed the transaction of interest. The actual content of that list will depend on the nature of each transaction and the respective contract:

```{r get-tx-by-id-with-raw-data, message=FALSE}
r2 <- get_tx_info_by_id(tx_id = tx_id, add_contract_data = TRUE)
glimpse(r2)

r2$contract_data[[1]]
```

Notice that all token amounts in the tibbles returned by `get_tx_info_by_id()` (see columns `trx_transfer`, `trc10_transfer`, `trc20_transfer`, and `internal_tx`) are expressed using the whole numbers and the decimal parts. However, if `add_contract_data = TRUE`, the returned raw contract data will show token amounts "as is", i.e. expressed using the machine-level precision. See `?apply_decimal` for details.

## Transactions that took place within a time range

To retrieve a list of transactions and their attributes for a certain period of time, one can use the `get_tx_for_time_range()` function. In comparison to `get_tx_info_by_id()`, this function has two additional arguments that define the time range of interest - `min_timestamp` and `max_timestamp`. Both of these arguments expect Unix timestamps (including milliseconds):

```{r get-tx-for-time-range, message=FALSE}
tx_df <- get_tx_for_time_range(min_timestamp = "1577836800000",
                               max_timestamp = "1577836803000")

glimpse(tx_df)
```

## Account-specific transactions

Using the `get_tx_info_by_account_address()` function one can also retrieve transaction data for a specific account. Moreover, this can be done for a specific time range:

```{r get-tx-info-for-account, message=FALSE}
tx_df_acc <- get_tx_info_by_account_address(
  address = "TAUN6FwrnwwmaEqYcckffC7wYmbaS6cBiX",
  min_timestamp = "1577836800000",
  max_timestamp = "1577838600000"
  )

glimpse(tx_df_acc)
```

> **Please note**: the number of transactions that take place on the TRON blockchain is very large, and thus users are advised to choose `min_timestamp` and `max_timestamp` wisely. If the requested time range is too large, the maximum number of transactions returned by the underlying [Tronscan API](https://github.com/tronscan/tronscan-frontend/blob/master/document/api.md "Tronscan frontend API") will be *capped* at 10000, and the processing time may become prohibitively long. Chunking the time range of interest into smaller periods can help to avoid gaps in data in such cases. However, users would have to implement their own logic for that.
